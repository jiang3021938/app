2026-02-07 22:07:07,437 - main - INFO - === Logging system initialized ===
2026-02-07 22:07:07,437 - main - INFO - Log file: logs/app_20260207_220707.log
2026-02-07 22:07:07,437 - main - INFO - Log level: INFO
2026-02-07 22:07:07,437 - main - INFO - Timestamp: 20260207_220707
2026-02-07 22:07:08,123 - main - INFO - Included router: routers.aihub.router
2026-02-07 22:07:08,139 - main - INFO - Included router: routers.auth.router
2026-02-07 22:07:08,183 - main - INFO - Included router: routers.documents.router
2026-02-07 22:07:08,387 - main - INFO - Included router: routers.extractions.router
2026-02-07 22:07:08,388 - main - INFO - Included router: routers.health.router
2026-02-07 22:07:08,413 - main - INFO - Included router: routers.lease_analysis.router
2026-02-07 22:07:08,464 - main - INFO - Included router: routers.payments.router
2026-02-07 22:07:08,489 - main - INFO - Included router: routers.settings.router
2026-02-07 22:07:08,531 - main - INFO - Included router: routers.state_regulations.router
2026-02-07 22:07:08,570 - main - INFO - Included router: routers.storage.router
2026-02-07 22:07:08,596 - core.config - DEBUG - Read dynamic attribute stripe_secret_key from environment variable STRIPE_SECRET_KEY
2026-02-07 22:07:08,605 - main - INFO - Included router: routers.stripe_payments.router
2026-02-07 22:07:08,612 - main - INFO - Included router: routers.user.router
2026-02-07 22:07:08,652 - main - INFO - Included router: routers.user_credits.router
2026-02-07 22:07:08,653 - main - INFO - === Application startup initiated ===
2026-02-07 22:07:08,653 - services.database - DEBUG - [DB_OP] Starting database initialization
2026-02-07 22:07:08,654 - services.database - INFO - ðŸ”§ Starting database initialization...
2026-02-07 22:07:08,654 - core.database - INFO - Starting database initialization...
2026-02-07 22:07:08,654 - core.config - DEBUG - Read dynamic attribute database_url from environment variable DATABASE_URL
2026-02-07 22:07:08,654 - core.database - INFO - Normalizing database URL for async compatibility...
2026-02-07 22:07:08,655 - core.database - INFO - Creating async database engine...
2026-02-07 22:07:08,655 - core.database - INFO - Using QueuePool with connection pooling for non-Lambda environment
2026-02-07 22:07:08,708 - core.database - INFO - Database engine created successfully
2026-02-07 22:07:08,708 - core.database - INFO - Creating async session maker...
2026-02-07 22:07:08,708 - core.database - INFO - Async session maker created successfully
2026-02-07 22:07:08,708 - core.database - INFO - Database connection initialized successfully
2026-02-07 22:07:08,708 - services.database - INFO - ðŸ”§ Database connection initialized, now creating tables if tables not exist...
2026-02-07 22:07:08,708 - core.database - DEBUG - [DB_OP] Starting create_tables
2026-02-07 22:07:08,708 - core.database - INFO - ðŸ”§ Starting table creation...
2026-02-07 22:07:10,232 - core.database - INFO - Tables initialized successfully
2026-02-07 22:07:10,232 - core.database - DEBUG - [DB_OP] Create tables completed in 1.5240s
2026-02-07 22:07:10,292 - services.database - INFO - ðŸ”§ Table creation completed
2026-02-07 22:07:10,293 - services.database - INFO - Database initialized successfully
2026-02-07 22:07:10,293 - services.database - DEBUG - [DB_OP] Database initialization completed in 1.6394s
2026-02-07 22:07:10,294 - services.mock_data - INFO - Processing mock data file state_regulations.json for table state_regulations
2026-02-07 22:07:12,244 - services.mock_data - INFO - Table state_regulations already has 50 rows; skipping mock insert
2026-02-07 22:07:12,304 - services.database - DEBUG - [DB_OP] Starting database initialization
2026-02-07 22:07:12,305 - services.database - INFO - ðŸ”§ Starting database initialization...
2026-02-07 22:07:12,305 - core.database - INFO - Starting database initialization...
2026-02-07 22:07:12,305 - core.database - INFO - Database already initialized
2026-02-07 22:07:12,306 - services.database - INFO - ðŸ”§ Database connection initialized, now creating tables if tables not exist...
2026-02-07 22:07:12,306 - core.database - DEBUG - [DB_OP] Starting create_tables
2026-02-07 22:07:12,306 - core.database - INFO - Tables already initialized
2026-02-07 22:07:12,306 - services.database - INFO - ðŸ”§ Table creation completed
2026-02-07 22:07:12,306 - services.database - INFO - Database initialized successfully
2026-02-07 22:07:12,306 - services.database - DEBUG - [DB_OP] Database initialization completed in 0.0021s
2026-02-07 22:07:12,306 - core.config - DEBUG - Read dynamic attribute admin_user_id from environment variable ADMIN_USER_ID
2026-02-07 22:07:12,307 - core.config - DEBUG - Read dynamic attribute admin_user_email from environment variable ADMIN_USER_EMAIL
2026-02-07 22:07:12,670 - services.auth - DEBUG - Admin user 956410 already exists
2026-02-07 22:07:12,730 - main - INFO - === Application startup completed successfully ===
2026-02-07 22:12:21,109 - dependencies.auth - DEBUG - Authentication required for request GET /api/v1/entities/documents
2026-02-07 22:13:20,629 - core.config - DEBUG - Read dynamic attribute jwt_secret_key from environment variable JWT_SECRET_KEY
2026-02-07 22:13:20,630 - core.config - DEBUG - Read dynamic attribute jwt_algorithm from environment variable JWT_ALGORITHM
2026-02-07 22:13:20,643 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:21,083 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:21,084 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:21,084 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0002s
2026-02-07 22:13:21,084 - routers.documents - DEBUG - Querying documentss: query=None, sort=-created_at, skip=0, limit=50, fields=None
2026-02-07 22:13:22,122 - routers.documents - DEBUG - Found 2 documentss
2026-02-07 22:13:22,124 - core.database - DEBUG - [DB_OP] Database session cleanup after 1.0401s
2026-02-07 22:13:22,569 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:22,569 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:22,570 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0004s
2026-02-07 22:13:22,985 - core.database - DEBUG - [DB_OP] Database session cleanup after 0.4157s
2026-02-07 22:13:29,391 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:29,862 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:29,863 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:29,863 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0004s
2026-02-07 22:13:29,863 - routers.documents - DEBUG - Fetching documents with id: 1, fields=None
2026-02-07 22:13:30,219 - core.database - DEBUG - [DB_OP] Database session cleanup after 0.3562s
2026-02-07 22:13:30,645 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:30,646 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:30,646 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0002s
2026-02-07 22:13:30,646 - routers.extractions - DEBUG - Querying extractionss: query={"document_id":1}, sort=None, skip=0, limit=1, fields=None
2026-02-07 22:13:31,119 - services.extractions - ERROR - Error fetching extractions list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2026-02-07 22:13:31,120 - routers.extractions - ERROR - Error querying extractionss: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 526, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 773, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 638, in prepare
    return await self._prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 657, in _prepare
    stmt = await self._get_statement(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 443, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedColumnError: column extractions.compliance_data does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/app/backend/routers/extractions.py", line 135, in query_extractionss
    result = await service.get_list(
  File "/workspace/app/backend/services/extractions.py", line 93, in get_list
    result = await self.db.execute(query.offset(skip).limit(limit))
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 449, in execute
    result = await greenlet_spawn(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2026-02-07 22:13:31,411 - core.database - ERROR - Database session error: 500: Internal server error: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 526, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 773, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 638, in prepare
    return await self._prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 657, in _prepare
    stmt = await self._get_statement(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 443, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedColumnError: column extractions.compliance_data does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/app/backend/routers/extractions.py", line 135, in query_extractionss
    result = await service.get_list(
  File "/workspace/app/backend/services/extractions.py", line 93, in get_list
    result = await self.db.execute(query.offset(skip).limit(limit))
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 449, in execute
    result = await greenlet_spawn(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/workspace/app/backend/core/database.py", line 534, in get_db
    yield session
  File "/data/.cache/python/lib/python3.10/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
  File "/data/.cache/python/lib/python3.10/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
  File "/data/.cache/python/lib/python3.10/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
  File "/workspace/app/backend/routers/extractions.py", line 148, in query_extractionss
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Internal server error: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2026-02-07 22:13:31,417 - core.database - DEBUG - [DB_OP] Database session cleanup after 0.7712s
2026-02-07 22:13:31,476 - core.database - ERROR - Failed to create database session: 500: Internal server error: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 526, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 773, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 638, in prepare
    return await self._prepare(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 657, in _prepare
    stmt = await self._get_statement(
  File "/data/.cache/python/lib/python3.10/site-packages/asyncpg/connection.py", line 443, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedColumnError: column extractions.compliance_data does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/app/backend/routers/extractions.py", line 135, in query_extractionss
    result = await service.get_list(
  File "/workspace/app/backend/services/extractions.py", line 93, in get_list
    result = await self.db.execute(query.offset(skip).limit(limit))
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 449, in execute
    result = await greenlet_spawn(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/workspace/app/backend/core/database.py", line 534, in get_db
    yield session
  File "/data/.cache/python/lib/python3.10/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
  File "/data/.cache/python/lib/python3.10/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
  File "/data/.cache/python/lib/python3.10/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
  File "/workspace/app/backend/routers/extractions.py", line 148, in query_extractionss
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Internal server error: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column extractions.compliance_data does not exist
[SQL: SELECT extractions.id, extractions.user_id, extractions.document_id, extractions.tenant_name, extractions.landlord_name, extractions.property_address, extractions.monthly_rent, extractions.security_deposit, extractions.lease_start_date, extractions.lease_end_date, extractions.renewal_notice_days, extractions.pet_policy, extractions.late_fee_terms, extractions.risk_flags, extractions.compliance_data, extractions.raw_extraction, extractions.created_at 
FROM extractions 
WHERE extractions.user_id = $1::VARCHAR AND extractions.document_id = $2::INTEGER ORDER BY extractions.id DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: ('956410', 1, 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2026-02-07 22:13:37,018 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:37,419 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:37,419 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:37,420 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0002s
2026-02-07 22:13:37,420 - routers.documents - DEBUG - Querying documentss: query=None, sort=-created_at, skip=0, limit=50, fields=None
2026-02-07 22:13:37,782 - routers.documents - DEBUG - Found 2 documentss
2026-02-07 22:13:37,783 - core.database - DEBUG - [DB_OP] Database session cleanup after 0.3633s
2026-02-07 22:13:38,255 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:38,255 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:38,256 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0005s
2026-02-07 22:13:38,551 - core.database - DEBUG - [DB_OP] Database session cleanup after 0.2956s
2026-02-07 22:13:40,500 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:46,004 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:46,005 - core.config - DEBUG - Read dynamic attribute oss_service_url from environment variable OSS_SERVICE_URL
2026-02-07 22:13:46,005 - core.config - DEBUG - Read dynamic attribute oss_api_key from environment variable OSS_API_KEY
2026-02-07 22:13:46,216 - httpcore.connection - DEBUG - connect_tcp.started host='atoms.dev' port=443 local_address=None timeout=120.0 socket_options=None
2026-02-07 22:13:46,230 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7fa4fcaee980>
2026-02-07 22:13:46,231 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x7fa4fcdfc940> server_hostname='atoms.dev' timeout=120.0
2026-02-07 22:13:46,239 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7fa4fdb42080>
2026-02-07 22:13:46,239 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-02-07 22:13:46,240 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-02-07 22:13:46,240 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-02-07 22:13:46,240 - httpcore.http11 - DEBUG - send_request_body.complete
2026-02-07 22:13:46,240 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-02-07 22:13:46,280 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sun, 08 Feb 2026 06:13:46 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Access-Control-Allow-Headers', b'Origin, Content-Type, Accept, Authorization'), (b'Access-Control-Allow-Methods', b'GET, POST, PUT, DELETE, OPTIONS'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Max-Age', b'86400'), (b'X-Request-Id', b'ecf8458f91485496e6fdafa896676853'), (b'X-Trace-Id', b'57b5b7b97c2849bbbe17ac9063006094'), (b'Content-Security-Policy', b"frame-ancestors 'self' https://atoms.dev"), (b'Strict-Transport-Security', b'max-age=63072000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'X-XSS-Protection', b'1; mode=block'), (b'Referrer-Policy', b'strict-origin-when-cross-origin'), (b'cf-cache-status', b'DYNAMIC'), (b'Content-Encoding', b'gzip'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9ca8fba409aadcc7-LAX')])
2026-02-07 22:13:46,281 - httpx - INFO - HTTP Request: POST https://atoms.dev/api/v1/infra/client/oss/buckets/lease-documents/objects/upload_url "HTTP/1.1 200 OK"
2026-02-07 22:13:46,282 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-02-07 22:13:46,283 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-02-07 22:13:46,283 - httpcore.http11 - DEBUG - response_closed.started
2026-02-07 22:13:46,284 - httpcore.http11 - DEBUG - response_closed.complete
2026-02-07 22:13:46,284 - httpcore.connection - DEBUG - close.started
2026-02-07 22:13:46,284 - httpcore.connection - DEBUG - close.complete
2026-02-07 22:13:49,745 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:49,746 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:49,746 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0003s
2026-02-07 22:13:49,747 - routers.documents - DEBUG - Creating new documents with data: file_name='California-Standard-Residential-Lease-Agreement.pdf' file_key='leases/956410/1770531226434-California-Standard-Residential-Lease-Agreement.pdf' file_size=81319 status='pending' created_at=datetime.datetime(2026, 2, 8, 6, 13, 50, 194000, tzinfo=TzInfo(UTC)) updated_at=datetime.datetime(2026, 2, 8, 6, 13, 50, 194000, tzinfo=TzInfo(UTC))
2026-02-07 22:13:50,521 - services.documents - INFO - Created documents with id: 3
2026-02-07 22:13:50,522 - routers.documents - INFO - Documents created successfully with id: 3
2026-02-07 22:13:50,523 - core.database - DEBUG - [DB_OP] Database session cleanup after 0.7766s
2026-02-07 22:13:50,899 - core.auth - DEBUG - Authentication token validated for user hash: a89dfb40
2026-02-07 22:13:50,899 - core.database - DEBUG - [DB_OP] Starting get_db session creation
2026-02-07 22:13:50,900 - core.database - DEBUG - [DB_OP] Database session created successfully in 0.0002s
2026-02-07 22:13:51,783 - services.documents - INFO - Updated documents 3
2026-02-07 22:13:51,783 - core.config - DEBUG - Read dynamic attribute app_ai_base_url from environment variable APP_AI_BASE_URL
2026-02-07 22:13:51,783 - core.config - DEBUG - Read dynamic attribute app_ai_key from environment variable APP_AI_KEY
2026-02-07 22:13:52,355 - services.aihub - ERROR - gentxt error: argument 'by_alias': 'NoneType' object cannot be converted to 'PyBool'
2026-02-07 22:13:52,356 - services.lease_extraction - ERROR - Lease extraction error: argument 'by_alias': 'NoneType' object cannot be converted to 'PyBool'
2026-02-07 22:13:52,829 - services.documents - INFO - Updated documents 3
2026-02-07 22:13:52,830 - core.database - DEBUG - [DB_OP] Database session cleanup after 1.9307s
2026-02-07 22:18:41,995 - services.database - DEBUG - [DB_OP] Starting database close
2026-02-07 22:18:42,058 - core.database - INFO - Database connection closed and engine disposed
2026-02-07 22:18:42,058 - services.database - INFO - Database connections closed
2026-02-07 22:18:42,059 - services.database - DEBUG - [DB_OP] Database close completed in 0.0633s
